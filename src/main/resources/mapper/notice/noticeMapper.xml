<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pcwk.ehr.mapper.NoticeMapper">

  <resultMap type="com.pcwk.ehr.notice.NoticeVO" id="noticeMap">
    <id     column="NOTICE_SID"      property="noticeSid"/>
    <result column="NOTICE_TITLE"    property="noticeTitle"/>
    <result column="NOTICE_CONTENT"  property="noticeContent"/>
    <result column="NOTICE_UPDATE"   property="noticeUpdate"/>
    <result column="NOTICE_TIME"     property="noticeTime"/>
    <result column="REG_ID"          property="regId"/>
  </resultMap>

  <insert id="doSave" parameterType="com.pcwk.ehr.notice.NoticeVO">
    INSERT INTO NOTICE (
        NOTICE_SID,
        NOTICE_TITLE,
        NOTICE_CONTENT,
        NOTICE_UPDATE,
        NOTICE_TIME,
        REG_ID
    ) VALUES (
        NOTICE_SEQ.NEXTVAL,  #{noticeTitle},
        #{noticeContent},
        SYSDATE,             SYSDATE,             #{regId}
    )
  </insert>

  <select id="doSelectOne" parameterType="com.pcwk.ehr.notice.NoticeVO" resultMap="noticeMap">
    SELECT 
        NOTICE_SID,
        NOTICE_TITLE,
        NOTICE_CONTENT,
        TO_CHAR(NOTICE_UPDATE, 'YYYY-MM-DD HH24:MI:SS') AS NOTICE_UPDATE,
        TO_CHAR(NOTICE_TIME,   'YYYY-MM-DD HH24:MI:SS') AS NOTICE_TIME,
        REG_ID
    FROM NOTICE
    WHERE NOTICE_SID = #{noticeSid}
  </select>

  <update id="doUpdate" parameterType="com.pcwk.ehr.notice.NoticeVO">
    UPDATE NOTICE
    SET NOTICE_TITLE   = #{noticeTitle},
        NOTICE_CONTENT = #{noticeContent},
        NOTICE_UPDATE  = SYSDATE    WHERE NOTICE_SID   = #{noticeSid}
  </update>

  <delete id="doDelete" parameterType="com.pcwk.ehr.notice.NoticeVO">
    DELETE FROM NOTICE
    WHERE NOTICE_SID = #{noticeSid}
  </delete>
  
  <select id="getAll" resultMap="noticeMap">
    SELECT 
        NOTICE_SID,
        NOTICE_TITLE,
        NOTICE_CONTENT,
        TO_CHAR(NOTICE_UPDATE, 'YYYY-MM-DD HH24:MI:SS') AS NOTICE_UPDATE,
        TO_CHAR(NOTICE_TIME,   'YYYY-MM-DD HH24:MI:SS') AS NOTICE_TIME,
        REG_ID
    FROM NOTICE
    ORDER BY NOTICE_SID DESC
  </select>

  <select id="getCount" resultType="int">
    SELECT COUNT(*) FROM NOTICE
  </select>
  
  <delete id="deleteAll">
    DELETE FROM NOTICE
  </delete>

</mapper>